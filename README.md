<div align="center">
  <h1>AddressParsing</h1>
  <p>
    简单地址归一化C#算法
  </p>
  <p>
    .NET Core (2.0)
  </p>
</div>

## Nuget 安装
- [Nuget](https://www.nuget.org/packages/AddressParsing/)

```
PM> Install-Package AddressParsing
```
## 性能
配置（i7-8750H，单核最高睿频 4.1，内存随意）： 
1：一级区划（省、自治区、直辖市）开头的地址，单次匹配`≈0.01`毫秒，每秒可处理地址数量：`100000`  
```
地址：河北省石家庄市裕华区槐安东路121号万达写字楼
00:00:00.0000097
Weight:1
MatchedRegions:MatchType:PathName, MatchIndex:0, MatchName:河北省石家庄市裕华区, MatchRegion:河北省 - 石家庄市 - 裕华区
处理：河北省 - 石家庄市 - 裕华区 - 槐安东路121号万达写字楼
```
2：二、三级区划（市、市辖区、县）开头的地址，单次匹配最快`≤0.01`毫秒，最慢也就是未匹配到，平均时间`<0.5`毫秒，每秒处理地址数量：`2000-100000`
```
地址：石家庄市裕华区槐安东路121号万达写字楼
00:00:00.0000110
Weight:1
MatchedRegions:MatchType:PathName, MatchIndex:0, MatchName:石家庄市裕华区, MatchRegion:河北省 - 石家庄市 - 裕华区
处理：河北省 - 石家庄市 - 裕华区 - 槐安东路121号万达写字楼

地址：馒檐犬乔搯钙^旊戠掾齊鉟馒檐犬乔搯钙^旊戠掾齊鉟
00:00:00.0003754
```
## 用法

```csharp
//设置一级区划匹配优先级，当地址不是以一级区划（省、直辖市、自治区）开头时，优先匹配的一级区划
AddressParser.MakePrioritySort(
        _p =>
        {
            switch (_p.Name)
            {
                case "上海市":
                    return 0;

                case "江苏省":
                    return 1;

                //......
            }

            return 99;
        }
    );

while (true)
{
    Console.Write("地址：");
    var address = Console.ReadLine();

    Stopwatch sw = Stopwatch.StartNew();
    var matchitems = AddressParser.ParsingAddress(address);
    sw.Stop();
    Console.WriteLine(sw.Elapsed);

    foreach (var matchitem in matchitems)
    {
        Console.WriteLine(matchitem);
        Console.WriteLine("处理：" + AddressParser.FinalCut(matchitem, address));
    }

    Console.WriteLine();
}
```

## 输出示例：
```
原始：闸北区大统路938弄6号1301室
上海市 - 上海市 - 闸北区 - 大统路938弄6号1301室

原始：崇明县 陈家镇 陈家镇裕民路 79号
上海市 - 上海市 - 崇明县 - 陈家镇 陈家镇裕民路 79号

原始：虹口区 江湾镇 场中路 803弄4号402室
上海市 - 上海市 - 虹口区 - 江湾镇 场中路 803弄4号402室

原始：浦东新区 高桥镇  潼港一村15号401室
上海市 - 上海市 - 浦东新区 - 高桥镇  潼港一村15号401室

原始：静安区 江宁路街道 陕西北路 525弄4号31室
上海市 - 上海市 - 静安区 - 江宁路街道 陕西北路 525弄4号31室

原始：闸北区 共和新路街道 洛川东路 352弄7号403
上海市 - 上海市 - 闸北区 - 共和新路街道 洛川东路 352弄7号403

原始：闸北区彭浦新村210号甲306室
上海市 - 上海市 - 闸北区 - 彭浦新村210号甲306室

原始：江苏省海门市常乐镇颐生村一组14号
江苏省 - 南通市 - 海门市 - 常乐镇颐生村一组14号

原始：虹口区 四川北街道 多伦路 201弄99号
上海市 - 上海市 - 虹口区 - 四川北街道 多伦路 201弄99号

原始：宝山区 通河街道  呼玛二村193号101室
黑龙江省 - 双鸭山市 - 宝山区 - 通河街道  呼玛二村193号101室
上海市 - 上海市 - 宝山区 - 通河街道  呼玛二村193号101室
```

## 算法解析

### 概念
- `Name`：  
	安徽省 -> 安徽省  
	宿州市 -> 宿州市  
	砀山县 -> 砀山县  
- `ShortName`：可有多个  
	安徽省 -> 安徽  
	宿州市 -> 宿州、宿县  
	砀山县 -> 砀山  
- `PathName`：顶级地址不用设置`PathName`，二三级区划（路径名称按照字符串长度降序排列，其实就是直属的和间接直属的`Name`和`ShortName`的组合）：  
	宿州市的路径名称为：安徽省宿州市、安徽省宿州、安徽宿州市、安徽宿州  
	砀山县的路径名称为：安徽省宿州市砀山县、安徽省宿州市砀山、安徽宿州市砀山县、安徽宿州砀山，宿州市砀山县、宿州砀山、……  
- `Path`：  
	安徽省 -> 安徽省  
	宿州市 -> 安徽省 - 宿州市  
	砀山县 -> 安徽省 - 宿州市 - 砀山县  

### 解析
- 数据结构  
  基本三级区划、简称、全称、路径
- 预处理  
  将地址中的一些特殊字符移除掉，便于后续路径名匹配
- 匹配  
  从字符串起始位置开始循环和递归匹配全称和简称，匹配之前会调用进行索引快速命中
- 规则  
  若是匹配过程没有全称匹配并且结果集数量大于1，进行规则处理。若有全称匹配，则直接取出全称匹配项。最下级的全称匹配有绝对的优先级。
- 后续
算法会不定期微调和性能提升，所以源码和解析可能有点出入。  
（待补充）

### 题外话
算法内部包装了什么高级算法吗？没有！！！核心就是`string.IndexOf()`方法